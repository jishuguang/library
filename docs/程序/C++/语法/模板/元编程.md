# 元编程

```{mermaid}
mindmap
元编程
    Dimension
        Computation
        Reflection
        Generation
    Typelist
    Tuple
```

## 元编程的维度

metaprogramming solution for C++ must make choices along three dimensions:
- Computation
- Reflection: the ability to programmatically inspect features of the program
- Generation: the ability to generate additional code for the program.

### Computaion

```cpp
// value metaprogrammming
template<typename T>
constexpr T sqrt(T x)
{/* ...... */}
```

### Reflection

```cpp
// primary template
template<typename T>
struct RemoveAllExtentsT {
    using Type = T;
};

// partial specializations for array types (with and without bounds)
template<typename T, std::size_t SZ>
struct RemoveAllExtentsT<T[SZ]> {
    using Type = typename RemoveAllExtentsT<T>::Type;
};

// other partial specialization
// ......

// RemoveAllExtents is a type metafunction
template<typename T>
using RemoveAllExtents = typename RemoveAllExtentsT<T>::Type;
```

### Generation

Programmatically assemble at compile time bits of code with a run-time effect.

```cpp
template<typename T, std::size_t N>
struct DotProductT {
    static inline T result(T* a, T* b) {
        return *a * *b + DotProduct<T, N-1>::result(a+1,b+1);
    }
};
// partial specialization as end criteria
template<typename T>
struct DotProductT<T, 0> {
    static inline T result(T*, T*) {
        return T{};
    }
};

// a compile-time computation (achieved here through recursive template instantiation) that determines the overall structure of the code with a run-time computation (calling result()) that determines the specific run-time effect.
template<typename T, std::size_t N>
auto dotProduct(std::array<T, N> const& x, std::array<T, N> const& y)
{
    return DotProductT<T, N>::result(x.begin(), y.begin());
}
```

## Typelist

A typelist is a type that represents a list of types and can be manipulated by a template metaprogram, which is typically implemented as a class template specialization.

Typelist algorithm
- indexing
- appending
- reversing
- transforming
- accumulating
- insertion

Nontype typelist
- can be based on `std::integral_constant`

## Tuple