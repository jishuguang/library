# 创建型设计模式

## Singleton

### 典型实现

```cpp
class Singleton
{
public:
    static Singleton& Instance()
    {
        static Singleton singleton;
        return singleton;
    }
};
private:
    Singleton() { /* code */ }
    // 不支持拷贝/移动
    Singleton(const Singleton&) = delete;
    Singleton(Singleton&&) = delete;
    Singleton& operator=(const Singleton&) = delete;
    Singleton(Singleton&&) = delete;
```

```{note}
补充C++ static线程安全的说明及初始化时机。
```

### 问题及规避

```{note}
单例的析构函数不可调用其它单例，因为单例之间的析构顺序没有约束。
```

可通过如下方式规避单例析构调用单例问题：

```cpp
public:
    static Singleton& Instance()
    {
        static Singleton* singleton = new Singleton();
        return *singleton;
    }
```

```{note}
补充分析单例降低可测试性，例如单例难以打桩。
```

```{note}
补充分析单例降低代码可重构性，例如散落各处的Sigleton::Instance()，如何通过依赖注入进行规避。
```

## Factory

## Builder

## Prototype

